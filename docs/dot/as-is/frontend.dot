graph backend {
    label="Front End"
    splines="line"
    compound=true
    fontname="sans-serif" fontcolor=grey
    node[shape=none fontname="sans-serif"]
    edge[fontname="sans-serif"]
    graph[fontcolor=grey color=grey]

    subgraph cluster_io { label="IO"
        Keyboard[label="The Keyboard"]
        Mouse[label="The Mouse"]
    }
    subgraph cluster_server { label="Server"
        LanguageServerKernel[label="The Language Server Kernel"]
    }
    subgraph cluster_lab { label="JupyterLab"
        WidgetTrackers
        SettingsManager
        ServiceManager

        subgraph cluster_singletons { label="Singletons"
            Plugin
            StatusBarItem
            DiagnosticPanel
            ConnectionManager
            LanguageServerManager
        }

        subgraph cluster_kernels { label="Kernels"
            ClientLanguageServerKernel[label="The Language Server Kernel"]
        }

        subgraph cluster_lang {label="Per Language"
            Connection
            LanguageServerComm
            Comm
        }

        subgraph cluster_doc { label="Per Document"
            Widget
            CodeMirrors
            subgraph cluster_doc_lsp { label="LSP Client"
                WidgetAdapter
                VirtualEditor
                VirtualDocument
                CodeMirrorAdapters
                subgraph cluster_features { label="Features"
                    Feature[style=invisible]
                    Completion
                    Diagnostics
                    Highlight
                    Hover
                    Jump
                    Rename
                    Signature
                }
            }
        }
    }

    {Connection CodeMirrors VirtualDocument VirtualEditor} -- Feature[lhead=cluster_features];
    Diagnostics -- DiagnosticPanel
    Connection -- ConnectionManager -- LanguageServerManager -- ClientLanguageServerKernel
    CodeMirrors -- CodeMirrorAdapters -- WidgetAdapter
    WidgetAdapter -- VirtualEditor -- VirtualDocument
    WidgetTrackers -- {Plugin -- Widget}
    StatusBarItem -- Connection
    Widget -- WidgetAdapter -- Plugin -- StatusBarItem -- LanguageServerManager -- SettingsManager
    Widget -- CodeMirrors
    Plugin -- {ConnectionManager LanguageServerManager}
    Connection -- LanguageServerComm -- Comm -- ClientLanguageServerKernel -- ServiceManager -- LanguageServerKernel
    {Keyboard Mouse} -- CodeMirrors
}
